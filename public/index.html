<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Hello Electron</title>
	<style media="screen">
		* {
			margin:0;
			padding:0
		}
		body {
			border:1px solid #f00
		}
	</style>
</head>
<body>
	<h1> Hello world</h1>

	<button type="button" @click="escrever()" name="button">escrever</button>

	<div id="app">
		<table>
			<thead>
				<tr>
						<th v-for="(value, key) in objects[0]">{{ key }}</th>
				</tr>
			</thead>
			<tbody>
				<tr v-for="object in objects">
					<td v-for="(value, key) in object">{{ value }}</td>
				</tr>
			</tbody>
		</table>
	</div>

	<script>
		require('./index.js')
		const Vue = require('vue/dist/vue.js')
		//const App = require('./App.vue')

		const csv = require('fast-csv')
		const fs = require('fs')

		 new Vue({
			 el: "#app",
			 data: {
				 objects: [],
				 file: __dirname + "/my.csv"
			 },
			 methods: {
				 buscaCsv () {
					 let _self = this
					 var stream = fs.createReadStream(_self.file);
	 				csv
	 				 .fromStream(stream, {headers : ["nome", "idade", "cidade"]})
	 				 .on("data", function(data){
	 				     _self.objects.push(data);
	 				 })
	 				 .on("end", function(){
	 				     console.log("done");
	 				 });
				 },
				 escrever () {
					 let _self = this
					 var csvStream = csv.createWriteStream({headers: true}),
						    writableStream = fs.createWriteStream(_self.file);

						writableStream.on("finish", function(){
						  console.log("DONE!");
						});

						csvStream.pipe(writableStream);
						csvStream.write({a: "meu pe", b: "fdfdfd", c:"serrao"});
						csvStream.write({a: "meu pe", b: "fdfdfd", c:"serrao"});
						csvStream.write({a: "meu pe", b: "fdfdfd", c:"serrao"});
						csvStream.write({a: "meu pe", b: "fdfdfd", c:"serrao"});
						csvStream.write({a: "meu pe", b: "fdfdfd", c:"serrao"});
						csvStream.write({a: "meu pe", b: "fdfdfd", c:"serrao"});
						csvStream.end(function(){
							_self.buscaCsv()
						});
				 }
			 },
			 mounted () {
				 this.escrever()
			 }
		 })
	</script>
</body>
</html>
